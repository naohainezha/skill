"""
å°çº¢ä¹¦ç¬”è®°ç”Ÿæˆå™¨ - åŸºäºé‡‡é›†åˆ†æç”Ÿæˆæ–°ç¬”è®°
"""
import os
import sys
import json
import random
from pathlib import Path
from datetime import datetime

# è®¾ç½®UTF-8ç¼–ç è¾“å‡º
if sys.platform == 'win32':
    import codecs
    if hasattr(sys.stdout, 'buffer'):
        sys.stdout = codecs.getwriter('utf-8')(sys.stdout.buffer, 'strict')
    if hasattr(sys.stderr, 'buffer'):
        sys.stderr = codecs.getwriter('utf-8')(sys.stderr.buffer, 'strict')


class XHSNoteGenerator:
    """å°çº¢ä¹¦ç¬”è®°ç”Ÿæˆå™¨"""

    def __init__(self, keyword):
        self.keyword = keyword
        self.templates = {
            "æ•™ç¨‹æ”»ç•¥": {
                "titles": [
                    "ğŸ‘“{topic}ä¸‡èƒ½å…¬å¼ï¼Œå°ç™½å¿…çœ‹ï¼",
                    "æ–°æ‰‹å¿…å­¦ï¼{topic}å®Œå…¨æŒ‡å—âœ¨",
                    "3åˆ†é’Ÿå­¦ä¼š{topic}ï¼Œçœé’±åˆçœå¿ƒğŸ’°",
                    "åˆ«å†ä¹±ä¹°äº†ï¼{topic}é€‰è´­æ”»ç•¥ğŸ“–",
                    "{topic}é¿å‘æŒ‡å—ï¼Œè¿™äº›è¦çŸ¥é“âš ï¸"
                ],
                "contents": [
                    """å¥½å¤šå§å¦¹é—®æˆ‘{topic}çš„é—®é¢˜ï¼Œä»Šå¤©æ•´ç†äº†ä¸€ä»½è¶…å…¨æ”»ç•¥ğŸ“–

ğŸŒŸ ä»€ä¹ˆæ˜¯{topic}ï¼Ÿ
ç®€å•æ¥è¯´å°±æ˜¯{definition}

âœ… é€‰è´­è¦ç‚¹ï¼š
1. çœ‹æè´¨ - {tip1}
2. çœ‹é£æ ¼ - {tip2}
3. çœ‹æ€§ä»·æ¯” - {tip3}

ğŸ’¡ æˆ‘çš„å»ºè®®ï¼š
{advice}

å¸Œæœ›è¿™ç¯‡æ”»ç•¥å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼æœ‰é—®é¢˜è¯„è®ºåŒºè§ğŸ’•

#{tag1} #{tag2} #æ–°æ‰‹æ”»ç•¥ #å¹²è´§åˆ†äº«""",
                ]
            },
            "ç©¿æ­åˆ†äº«": {
                "titles": [
                    "æ¸©æŸ”æ„Ÿæ‹¿æğŸ¥¯{topic}æ­é…æ—¥è®°",
                    "ä»Šæ—¥ä»½ç”œå¦¹OOTDï½œ{topic}âœ¨",
                    "éŸ©ç³»{topic}ç©¿æ­ï¼Œå¤ªæ¸©æŸ”äº†ï½",
                    "è°æ‡‚å•Šï¼{topic}è¿™ä¹ˆæ­ç»äº†ğŸ”¥",
                    "ä¸Šç­{topic}ç©¿æ­ï¼Œè¢«é—®äº†800é"
                ],
                "contents": [
                    """ä»Šæ—¥cleanfitğŸ“¸

{outfit_desc}

æ•´ä½“lookå°±æ˜¯{style}çš„æ„Ÿè§‰ï½
{detail}

{compliment}

å§å¦¹ä»¬è¯•è¯•çœ‹ï¼ŒçœŸçš„å¾ˆç»ï¼ğŸ˜

#æ—¥å¸¸ç©¿æ­ #OOTD #{tag1} #æ¸©æŸ”ç³» #éŸ©å¼ç©¿æ­ #ä»Šæ—¥æ­é…"""
                ]
            },
            "æ—¥å¸¸è®°å½•": {
                "titles": [
                    "å¹³å‡¡çš„ä¸€å¤©âœ¨{topic}é™ªä¼´",
                    "å°ç¡®å¹¸ğŸŒ¸{topic}æ—¥å¸¸",
                    "è®°å½•ç”Ÿæ´»ï½œ{topic}è®©æˆ‘å¼€å¿ƒ",
                    "å¥½å¥½ç”Ÿæ´»ğŸŒˆ{topic}åœ¨èº«è¾¹",
                    "ä»Šæ—¥ä»½å¿ƒæƒ…ï¼š{topic}ç›¸ä¼´â˜€ï¸"
                ],
                "contents": [
                    """{opening}

{life_detail}

{feeling}

{closing}

#{tag1} #æ—¥å¸¸è®°å½• #ç”Ÿæ´»ç¢ç‰‡ #{tag2} #å¥½å¥½ç”Ÿæ´»"""
                ]
            },
            "äº§å“åˆé›†": {
                "titles": [
                    "2025{topic}åˆé›†ï¼Œæ¯æ ·éƒ½çˆ±äº†ğŸ’•",
                    "{topic}å¤©èŠ±æ¿ï¼Œè¿™5ä¸ªç»äº†ï¼",
                    "å¿…å…¥æ¸…å•ï¼{topic}æ¨èğŸ“",
                    "æ— é™å›è´­çš„{topic}åˆé›†ğŸ›’",
                    "å‡ä»·{price}ï¼{topic}å¹³ä»·å¥½ç‰©"
                ],
                "contents": [
                    """æ•´ç†äº†5æ¬¾è¶…èµçš„{topic}ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯çœŸçˆ±ğŸ’•

1ï¸âƒ£ {item1}
{desc1}

2ï¸âƒ£ {item2}
{desc2}

3ï¸âƒ£ {item3}
{desc3}

4ï¸âƒ£ {item4}
{desc4}

5ï¸âƒ£ {item5}
{desc5}

éƒ½æ˜¯æ€§ä»·æ¯”è¶…é«˜çš„ï¼Œå§å¦¹ä»¬æ”¾å¿ƒå†²ï¼ğŸ›’

#{tag1} #å¥½ç‰©æ¨è #{tag2} #å¹³ä»·å¥½ç‰© #è´­ç‰©æ¸…å•"""
                ]
            }
        }

        self.data = {
            "å¥³ç”Ÿçœ¼é•œæ¨è": {
                "definition": "é€‰æ‹©é€‚åˆè‡ªå·±çš„çœ¼é•œæ¡†ï¼Œä¸ä»…èƒ½ä¿®é¥°è„¸å‹ï¼Œè¿˜èƒ½æå‡æ•´ä½“æ°”è´¨",
                "tip1": "ä¼˜å…ˆé€‰æ‹©è½»ä¾¿çš„é’›åˆé‡‘æè´¨",
                "tip2": "æ ¹æ®è„¸å‹é€‰æ¡†å‹ï¼Œåœ†è„¸é€‰æ–¹æ¡†ï¼Œæ–¹è„¸é€‰åœ†æ¡†",
                "tip3": "å…ˆåœ¨ç½‘ä¸Šçœ‹æµ‹è¯„ï¼Œå†å»çº¿ä¸‹è¯•æˆ´",
                "advice": "å»ºè®®æ–°æ‰‹å…ˆä»åŸºç¡€æ¬¾å…¥æ‰‹ï¼Œæ¯”å¦‚é»‘æ¡†ã€é€æ˜æ¡†ï¼Œä¸å®¹æ˜“å‡ºé”™ï¼",
                "price": "200",
                "outfit_desc": "ç±³ç™½è‰²é’ˆç»‡è¡« + å¡å…¶è‰²åŠè£™ + ç³ç‘çœ¼é•œæ¡†\næ•´ä½“å°±æ˜¯æ¸©æŸ”çš„éŸ©ç³»å­¦å§èŒƒå„¿ï½",
                "style": "æ¸©æŸ”çŸ¥æ€§å¸¦ç‚¹å°ç”œ",
                "detail": "è¿™ä¸ªé•œæ¡†çœŸçš„å¤ªä¿®é¥°è„¸å‹äº†ï¼æ–¹åœ†è„¸ä¹Ÿèƒ½è½»æ¾é©¾é©­",
                "compliment": "ä¸Šç­è¢«åŒäº‹é—®çˆ†äº†é“¾æ¥ï¼",
                "opening": "ä»Šå¤©æ˜¯è¢«çœ¼é•œæ²»æ„ˆçš„ä¸€å¤©âœ¨",
                "life_detail": "é˜³å…‰é€è¿‡é•œç‰‡æ´’åœ¨æ¡Œé¢ä¸Šï¼Œ\næˆ´ä¸Šå–œæ¬¢çš„çœ¼é•œï¼Œå¿ƒæƒ…éƒ½ä¼šå˜å¥½ï½",
                "feeling": "åŸæ¥ç”Ÿæ´»ä¸­æœ‰è¿™ä¹ˆå¤šå°ç¾å¥½\nåªéœ€è¦æˆ‘ä»¬ç”¨å¿ƒå‘ç°ğŸ’•",
                "closing": "å¸Œæœ›æ¯ä¸ªæˆ´çœ¼é•œçš„å§å¦¹éƒ½èƒ½æ‰¾åˆ°å±äºè‡ªå·±çš„é‚£ä»½ç¾å¥½",
                "item1": "æœ¨ä¹åç³ç‘æ¡† - æ¸©æŸ”éŸ©ç³»é£",
                "desc1": "å¤å¤åˆæ—¶å°šï¼Œé€‚åˆåœ†è„¸é¹…è›‹è„¸",
                "item2": "JINSè½»é‡æ¡† - ä¸Šç­æ—é¦–é€‰",
                "desc2": "è¶…è½»æè´¨ï¼Œæˆ´ä¸€å¤©ä¹Ÿä¸ç´¯",
                "item3": "é€æ˜æ ‘è„‚æ¡† - å­¦ç”Ÿå…šå¹³ä»·",
                "desc3": "æ€§ä»·æ¯”è¶…é«˜ï¼Œç™¾æ­ä¸å‡ºé”™",
                "item4": "é‡‘ä¸ç»†æ¡† - ç²¾è‡´è½»å¥¢",
                "desc4": "æ˜¾è„¸å°ï¼Œæ‹ç…§è¶…å‡ºç‰‡",
                "item5": "æ–¹æ¡†é»‘æ¡† - ä¿®é¥°è„¸å‹ç¥å™¨",
                "desc5": "æ–¹åœ†è„¸å¿…å…¥ï¼Œç¬é—´å°è„¸",
                "tag1": "çœ¼é•œæ¨è",
                "tag2": "å¥³ç”Ÿçœ¼é•œ"
            },
            "çœ¼é•œè¯•æˆ´": {
                "definition": "è¯•æˆ´æ˜¯é€‰çœ¼é•œçš„å…³é”®æ­¥éª¤ï¼Œåªæœ‰äº²è‡ªè¯•æˆ´æ‰èƒ½çŸ¥é“æ˜¯å¦é€‚åˆè‡ªå·±",
                "tip1": "å¤šè¯•å‡ ç§ä¸åŒé£æ ¼çš„é•œæ¡†",
                "tip2": "æ³¨æ„é•œæ¡†å®½åº¦è¦ä¸è„¸å‹åŒ¹é…",
                "tip3": "è¯•æˆ´æ—¶å¤šèµ°åŠ¨ï¼Œæ„Ÿå—èˆ’é€‚åº¦",
                "advice": "å»ºè®®ä¸€æ¬¡è¯•æˆ´3-5æ¬¾ï¼Œå¯¹æ¯”åé€‰æ‹©æœ€æ»¡æ„çš„ï¼",
                "price": "100",
                "outfit_desc": "ç´ é¢œè¯•æˆ´æœ€çœŸå®\næˆ´ä¸Šé‡‘ä¸æ¡†ç¬é—´æ¸©æŸ”äº†",
                "style": "ç®€çº¦æ¸…çˆ½",
                "detail": "åº—å‘˜å°å§å§è¯´æˆ‘æˆ´è¿™ä¸ªè¶…æ˜¾è„¸å°",
                "compliment": "è¯•æˆ´æ—¶è¢«å¥½å‡ ä¸ªäººé—®é“¾æ¥ï¼",
                "opening": "ä»Šå¤©å»è¯•æˆ´çœ¼é•œå•¦ï½",
                "life_detail": "è¯•äº†å¥½å‡ æ¬¾ï¼Œç»ˆäºæ‰¾åˆ°æœ¬å‘½çœ¼é•œï¼\nç´ é¢œæˆ´ä¹Ÿæ¯«æ— å‹åŠ›ï½",
                "feeling": "è¯•é•œçœŸçš„å¤ªé‡è¦äº†\næœ‰äº›çœ¼é•œçœ‹ç€å¥½çœ‹ï¼Œæˆ´ä¸Šä¸åˆé€‚",
                "closing": "å§å¦¹ä»¬ä¸€å®šè¦å»å®ä½“åº—è¯•æˆ´ï¼",
                "item1": "åœ†æ¡†é‡‘å±æ¬¾ - é€‚åˆæ–¹è„¸",
                "desc1": "æŸ”åŒ–è„¸éƒ¨çº¿æ¡ï¼Œæ˜¾æ¸©æŸ”",
                "item2": "å¤§æ–¹æ¡† - é€‚åˆåœ†è„¸",
                "desc2": "ä¿®é¥°è„¸å‹ï¼Œæ˜¾è„¸å°",
                "item3": "çŒ«çœ¼æ¡† - é€‚åˆ ovalè„¸",
                "desc3": "å¤å¤æ—¶é«¦ï¼Œæ‹ç…§å¥½çœ‹",
                "item4": "ä¸è§„åˆ™æ¡† - ä¸ªæ€§æ¬¾",
                "desc4": "é€‚åˆè¿½æ±‚ç‹¬ç‰¹çš„å§å¦¹",
                "item5": "é€æ˜æ¡† - ç™¾æ­ä¸å‡ºé”™",
                "desc5": "ç´ é¢œä¹Ÿèƒ½é©¾é©­",
                "tag1": "çœ¼é•œè¯•æˆ´",
                "tag2": "è¯•æˆ´ä½“éªŒ"
            },
            "æ–¹åœ†è„¸çœ¼é•œ": {
                "definition": "æ–¹åœ†è„¸é€‰çœ¼é•œé‡ç‚¹æ˜¯è¦æŸ”åŒ–è„¸éƒ¨çº¿æ¡ï¼Œé¿å…è¿‡äºæ£±è§’åˆ†æ˜æˆ–è¿‡äºåœ†æ¶¦çš„é•œæ¡†",
                "tip1": "é€‰æ‹©æœ‰æ£±è§’çš„é•œæ¡†æ¥ä¸­å’Œè„¸å‹çš„åœ†æ¶¦æ„Ÿ",
                "tip2": "é•œæ¡†å®½åº¦è¦ä¸é¢§éª¨å®½åº¦ç›¸å½“",
                "tip3": "é¿å…æ­£åœ†å½¢å’Œè¿‡äºæ–¹æ­£çš„é•œæ¡†",
                "advice": "æ–¹åœ†è„¸æœ€é€‚åˆä¸Šæ‰¬çš„çŒ«çœ¼æ¡†å’Œä¸è§„åˆ™æ¡†ï¼Œæ˜¾è„¸å°åˆæ—¶é«¦ï¼",
                "price": "150",
                "outfit_desc": "æ–¹åœ†è„¸æˆ´ç³ç‘æ¡†å¤ªç»äº†\nç¬é—´ä¿®é¥°è„¸å‹ï¼Œæ˜¾è„¸å°ä¸€åœˆ",
                "style": "æ¸©æŸ”æ°”è´¨",
                "detail": "ç»ˆäºæ‰¾åˆ°é€‚åˆæ–¹åœ†è„¸çš„çœ¼é•œäº†",
                "compliment": "æœ‹å‹éƒ½è¯´æˆ´è¿™ä¸ªæ˜¾è„¸å°ï¼",
                "opening": "æ–¹åœ†è„¸å§å¦¹çœ‹è¿‡æ¥ï¼",
                "life_detail": "ä½œä¸ºæ–¹åœ†è„¸ï¼Œé€‰çœ¼é•œçœŸçš„å¤ªä¸å®¹æ˜“äº†\nè¯•äº†å‡ åæ¬¾ç»ˆäºæ‰¾åˆ°æœ¬å‘½ï½",
                "feeling": "æ–¹åœ†è„¸ä¸æ˜¯ä¸‘è„¸\nåªæ˜¯æ²¡é€‰å¯¹çœ¼é•œï¼",
                "closing": "å¸Œæœ›æˆ‘çš„ç»éªŒèƒ½å¸®åˆ°æ–¹åœ†è„¸å§å¦¹ï¼",
                "item1": "ä¸Šæ‰¬çŒ«çœ¼æ¡† - æ˜¾è„¸å°ç¥å™¨",
                "desc1": "æ‹‰é•¿è„¸å‹ï¼Œè§†è§‰æ˜¾ç˜¦",
                "item2": "ç³ç‘ä¸è§„åˆ™æ¡† - æ¸©æŸ”æ°”è´¨",
                "desc2": "ä¿®é¥°é¢§éª¨ï¼Œè‡ªç„¶åˆå¥½çœ‹",
                "item3": "é‡‘å±æ–¹æ¡† - çŸ¥æ€§ä¼˜é›…",
                "desc3": "ä¸­å’Œåœ†æ¶¦æ„Ÿï¼Œæ˜¾é«˜çº§",
                "item4": "ç»†è¾¹æ¤­åœ†æ¡† - ç™¾æ­æ¸©æŸ”",
                "desc4": "ä¸æŒ‘äººï¼Œç´ é¢œä¹Ÿèƒ½æˆ´",
                "item5": "çœ‰çº¿æ¡† - å¤å¤æ—¶é«¦",
                "desc5": "å¤å¤é£æƒ…ï¼Œæ‹ç…§è¶…å¥½çœ‹",
                "tag1": "æ–¹åœ†è„¸çœ¼é•œ",
                "tag2": "è„¸å‹é…é•œ"
            }
        }

    def generate(self, note_type=None, count=5):
        """ç”Ÿæˆå°çº¢ä¹¦ç¬”è®°

        Args:
            note_type: ç¬”è®°ç±»å‹ï¼ˆæ•™ç¨‹æ”»ç•¥/ç©¿æ­åˆ†äº«/æ—¥å¸¸è®°å½•/äº§å“åˆé›†ï¼‰
                       å¦‚æœä¸ºNoneï¼Œåˆ™éšæœºåˆ†é…ç±»å‹
            count: ç”Ÿæˆæ•°é‡

        Returns:
            list: ç”Ÿæˆçš„ç¬”è®°åˆ—è¡¨
        """
        if self.keyword not in self.data:
            print(f"è­¦å‘Šï¼šå…³é”®è¯'{self.keyword}'æ²¡æœ‰é¢„è®¾æ•°æ®ï¼Œå°†ä½¿ç”¨é€šç”¨æ¨¡æ¿")
            data = {}
        else:
            data = self.data[self.keyword]

        notes = []
        types = list(self.templates.keys())

        for i in range(count):
            # éšæœºé€‰æ‹©ç±»å‹
            if note_type is None:
                current_type = random.choice(types)
            else:
                current_type = note_type

            template = self.templates[current_type]

            # ç”Ÿæˆæ ‡é¢˜
            title = random.choice(template["titles"]).format(
                topic=self.keyword.replace("å¥³ç”Ÿ", "").replace("æ¨è", ""),
                **data
            )

            # ç”Ÿæˆå†…å®¹
            content = random.choice(template["contents"]).format(
                topic=self.keyword.replace("å¥³ç”Ÿ", "").replace("æ¨è", ""),
                **data
            )

            # åˆ›å»ºç¬”è®°
            note = {
                "type": current_type,
                "title": title,
                "content": content,
                "keyword": self.keyword,
                "generated_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            }

            notes.append(note)

        return notes

    def save(self, notes, output_dir="output"):
        """ä¿å­˜ç”Ÿæˆçš„ç¬”è®°

        Args:
            notes: ç¬”è®°åˆ—è¡¨
            output_dir: è¾“å‡ºç›®å½•
        """
        output_path = Path(output_dir)
        output_path.mkdir(exist_ok=True)

        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        json_file = output_path / f"generated_{self.keyword}_{timestamp}.json"
        txt_file = output_path / f"generated_{self.keyword}_{timestamp}.txt"

        # ä¿å­˜JSONæ ¼å¼
        with open(json_file, 'w', encoding='utf-8') as f:
            json.dump(notes, f, ensure_ascii=False, indent=2)

        # ä¿å­˜æ–‡æœ¬æ ¼å¼ï¼ˆä¾¿äºé˜…è¯»ï¼‰
        with open(txt_file, 'w', encoding='utf-8') as f:
            for i, note in enumerate(notes, 1):
                f.write(f"\n{'='*60}\n")
                f.write(f"ç¬”è®° {i}\n")
                f.write(f"ç±»å‹ï¼š{note['type']}\n")
                f.write(f"{'='*60}\n\n")
                f.write(f"æ ‡é¢˜ï¼š{note['title']}\n\n")
                f.write(f"å†…å®¹ï¼š\n{note['content']}\n\n")
                f.write(f"ç”Ÿæˆæ—¶é—´ï¼š{note['generated_at']}\n")

        print(f"\nâœ… å·²ä¿å­˜ç”Ÿæˆç¬”è®°ï¼š")
        print(f"   JSON: {json_file}")
        print(f"   TXT:  {txt_file}")

        return json_file, txt_file


def main():
    """ä¸»å‡½æ•° - ç¤ºä¾‹ç”¨æ³•"""
    # åˆ›å»ºç”Ÿæˆå™¨
    generator = XHSNoteGenerator("å¥³ç”Ÿçœ¼é•œæ¨è")

    # ç”Ÿæˆ5ç¯‡ç¬”è®°ï¼ˆéšæœºç±»å‹ï¼‰
    print("æ­£åœ¨ç”Ÿæˆå°çº¢ä¹¦ç¬”è®°...")
    notes = generator.generate(count=5)

    # æ˜¾ç¤ºç”Ÿæˆçš„ç¬”è®°
    print("\n" + "="*60)
    print("ç”Ÿæˆçš„ç¬”è®°é¢„è§ˆ")
    print("="*60)

    for i, note in enumerate(notes, 1):
        print(f"\nã€ç¬”è®°{i} - {note['type']}ã€‘")
        print(f"æ ‡é¢˜ï¼š{note['title']}")
        print(f"å†…å®¹ï¼š{note['content'][:100]}...")
        print(f"æ ‡é¢˜é•¿åº¦ï¼š{len(note['title'])}å­—ç¬¦")
        print(f"å†…å®¹é•¿åº¦ï¼š{len(note['content'])}å­—ç¬¦")
        print(f"æ ‡ç­¾æ•°ï¼š{note['content'].count('#')}")

    # ä¿å­˜æ–‡ä»¶
    generator.save(notes)

    print("\nâœ… ç¬”è®°ç”Ÿæˆå®Œæˆï¼")


if __name__ == "__main__":
    main()
